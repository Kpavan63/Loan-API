<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Loans Pro - Loan Prediction System</title>
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/animate.css/animate.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #10b981;
            --background-color: #f4f4f5;
            --text-color: #27272a;
            --card-bg: #ffffff;
        }

        * {
            transition: all 0.3s ease;
        }

        body {
            background: var(--background-color);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            color: var(--text-color);
            line-height: 1.6;
        }

        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-color), #6366f1);
            color: white;
        }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.125);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .advanced-card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 
                0 10px 15px -3px rgba(0, 0, 0, 0.05), 
                0 4px 6px -2px rgba(0, 0, 0, 0.025);
            border: none;
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(90deg, var(--primary-color), #6366f1);
            color: white;
            padding: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .form-control, .form-select {
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.1);
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.9);
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn-predict {
            background: linear-gradient(90deg, var(--primary-color), #6366f1);
            border: none;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-predict:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-predict::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: all 0.5s;
        }

        .btn-predict:hover::before {
            left: 100%;
        }

        .result-container {
            background: rgba(255,255,255,0.9);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            color: var(--primary-color);
            border-bottom: 2px solid rgba(59, 130, 246, 0.2);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
            color: var(--primary-color);
        }

        .info-header {
            background: linear-gradient(90deg, var(--primary-color), #6366f1);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        #resultDisplay .alert {
            border-radius: 10px;
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .advanced-card {
                margin: 1rem;
            }
        }

        /* Loading Spinner */
        .spinner-custom {
            width: 3rem;
            height: 3rem;
            border-width: 0.25em;
        }

        /* Tooltips and Helper Text */
        .form-text {
            color: rgba(0,0,0,0.5);
            font-size: 0.8rem;
        }

        /* Select2 Customization */
        .select2-container--bootstrap-5 .select2-selection {
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.1);
            padding: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Header Information -->
    <div class="info-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <i class="fas fa-user me-2"></i>
                    User: <strong id="userLogin">Elite Loans Pro</strong>
                </div>
                <div class="col-md-6 text-md-end">
                    <i class="far fa-clock me-2"></i>
                    UTC: <strong id="currentDateTime">Loading...</strong>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container py-5">
        <div class="row g-4">
            <!-- Form Card -->
            <div class="col-lg-6">
                <div class="advanced-card animate__animated animate__fadeIn">
                    <div class="card-header">
                        <h3 class="mb-0">
                            <i class="fas fa-file-alt me-2"></i>Loan Application
                        </h3>
                        <span class="badge bg-light text-dark">Powered by AI</span>
                    </div>
                    <div class="card-body p-4">
                        <form id="loanForm" novalidate>
                            <!-- Personal Information -->
                            <div class="section-title">
                                <i class="fas fa-user"></i>Personal Information
                            </div>
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Gender</label>
                                    <select class="form-select" id="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="1">Male</option>
                                        <option value="0">Female</option>
                                    </select>
                                    <div class="form-text">Select your gender for personalized assessment</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Marital Status</label>
                                    <select class="form-select" id="married" required>
                                        <option value="">Select Status</option>
                                        <option value="1">Married</option>
                                        <option value="0">Single</option>
                                    </select>
                                    <div class="form-text">Your marital status may impact loan eligibility</div>
                                </div>
                            </div>

                            <!-- Financial Information -->
                            <div class="section-title">
                                <i class="fas fa-money-bill-wave"></i>Financial Information
                            </div>
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Applicant Income</label>
                                    <div class="input-group">
                                        <span class="input-group-text">₹</span>
                                        <input type="text" class="form-control" id="applicantIncome" required>
                                    </div>
                                    <div class="form-text">Your monthly income before taxes</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Co-applicant Income</label>
                                    <div class="input-group">
                                        <span class="input-group-text">₹</span>
                                        <input type="text" class="form-control" id="coapplicantIncome" required>
                                    </div>
                                    <div class="form-text">Combined income of additional applicants</div>
                                </div>
                            </div>

                            <!-- Loan Details -->
                            <div class="section-title">
                                <i class="fas fa-hand-holding-usd"></i>Loan Details
                            </div>
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Loan Amount</label>
                                    <div class="input-group">
                                        <span class="input-group-text">₹</span>
                                        <input type="text" class="form-control" id="loanAmount" required>
                                    </div>
                                    <div class="form-text">Requested loan amount in Indian Rupees</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Loan Term (months)</label>
                                    <input type="number" class="form-control" id="loanTerm" required>
                                    <div class="form-text">Preferred loan repayment period</div>
                                </div>
                            </div>

                            <!-- Additional Details -->
                            <div class="section-title">
                                <i class="fas fa-info-circle"></i>Additional Details
                            </div>
                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Education</label>
                                    <select class="form-select" id="education" required>
                                        <option value="">Select Education</option>
                                        <option value="1">Graduate</option>
                                        <option value="0">Not Graduate</option>
                                    </select>
                                    <div class="form-text">Highest level of education completed</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Self Employed</label>
                                    <select class="form-select" id="selfEmployed" required>
                                        <option value="">Select Status</option>
                                        <option value="Yes">Yes</option>
                                        <option value="No">No</option>
                                    </select>
                                    <div class="form-text">Employment type for risk assessment</div>
                                </div>
                            </div>

                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Dependents</label>
                                    <input type="number" class="form-control" id="dependents" min="0" required>
                                    <div class="form-text">Number of financial dependents</div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Credit History</label>
                                    <select class="form-select" id="creditHistory" required>
                                        <option value="">Select Credit History</option>
                                        <option value="1">Good</option>
                                        <option value="0">Bad</option>
                                    </select>
                                    <div class="form-text">Your past credit performance</div>
                                </div>
                            </div>

                            <div class="text-center">
                                <button type="submit" class="btn btn-predict">
                                    <i class="fas fa-check-circle me-2"></i>Predict Approval
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Result Card -->
            <div class="col-lg-6">
                <div id="resultDisplay" class="advanced-card animate__animated animate__fadeIn" style="display: none;">
                    <div class="card-header">
                        <h3 class="mb-0">
                            <i class="fas fa-chart-pie me-2"></i>Prediction Result
                        </h3>
                        <span class="badge bg-light text-dark">AI Analysis</span>
                    </div>
                    <div class="card-body p-4">
                        <div id="resultContent"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-morphism">
                <div class="modal-body text-center p-4">
                    <div class="spinner-border spinner-custom text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h4 class="mt-3">Processing Loan Application</h4>
                    <p class="text-muted">Advanced AI is analyzing your details...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastr@2.1.4/build/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cleave.js@1.6.0/dist/cleave.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Select2 for dropdowns
            $(document).ready(function() {
                $('select').select2({
                    theme: 'bootstrap-5'
                });
            });
        
            // Initialize Cleave.js for number formatting
            const numberInputs = ['applicantIncome', 'coapplicantIncome', 'loanAmount'];
            numberInputs.forEach(id => {
                new Cleave(`#${id}`, {
                    numeral: true,
                    numeralThousandsGroupStyle: 'thousand',
                    numeralPositiveOnly: true
                });
            });
        
            // Configure Toastr
            toastr.options = {
                closeButton: true,
                progressBar: true,
                positionClass: "toast-top-right",
                timeOut: 5000
            };
        
            // DateTime Update Function with exact format
            function updateDateTime() {
                const now = new Date();
                const year = now.getUTCFullYear();
                const month = String(now.getUTCMonth() + 1).padStart(2, '0');
                const day = String(now.getUTCDate()).padStart(2, '0');
                const hours = String(now.getUTCHours()).padStart(2, '0');
                const minutes = String(now.getUTCMinutes()).padStart(2, '0');
                const seconds = String(now.getUTCSeconds()).padStart(2, '0');
                
                const formatted = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                document.getElementById('currentDateTime').textContent = formatted;
                return formatted;
            }
        
            // Update time immediately and every second
            let currentDateTime = updateDateTime();
            setInterval(() => {
                currentDateTime = updateDateTime();
            }, 1000);
        
            // Form Submission Handler
            const form = document.getElementById('loanForm');
            const loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'));
        
            // Configure Axios
            axios.defaults.timeout = 10000; // 10 second timeout
            axios.defaults.headers.common['Content-Type'] = 'application/json';
            axios.defaults.headers.common['Accept'] = 'application/json';
        
            form.addEventListener('submit', async function(e) {
            e.preventDefault();
        
            // Validate form
            if (!form.checkValidity()) {
                e.stopPropagation();
                form.classList.add('was-validated');
                Swal.fire({
                    icon: 'error',
                    title: 'Validation Error',
                    text: 'Please fill all required fields correctly.'
                });
                return;
            }
        
            try {
                // Prepare form data in the required JSON format
                const formData = {
                    Gender: parseInt(document.getElementById('gender').value),
                    Married: parseInt(document.getElementById('married').value),
                    Dependents: parseInt(document.getElementById('dependents').value),
                    Education: parseInt(document.getElementById('education').value),
                    Self_Employed: document.getElementById('selfEmployed').value === "Yes" ? "Yes" : "No",
                    ApplicantIncome: parseFloat(document.getElementById('applicantIncome').value.replace(/,/g, '')),
                    CoapplicantIncome: parseFloat(document.getElementById('coapplicantIncome').value.replace(/,/g, '')),
                    LoanAmount: parseFloat(document.getElementById('loanAmount').value.replace(/,/g, '')),
                    Loan_Amount_Term: parseFloat(document.getElementById('loanTerm').value),
                    Credit_History: parseInt(document.getElementById('creditHistory').value)
                };
        
                // Show loading modal
                loadingModal.show();
        
                // Make API request with the correct data format
                const response = await axios({
                    method: 'post',
                    url: 'https://loan-api-c0xd.onrender.com/predict',
                    data: formData,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    validateStatus: function (status) {
                        return status >= 200 && status < 500;
                    }
                });
                
                // Hide loading modal
                loadingModal.hide();
        
                if (response.status === 200) {
                    // Prepare result display
                    const resultDiv = document.getElementById('resultDisplay');
                    const resultContent = document.getElementById('resultContent');
                    
                    // Format display content for prediction result
                    const displayContent = `
                        <div class="result-header">
                            <div class="mb-3">
                                <strong>Current Date and Time (UTC - YYYY-MM-DD HH:MM:SS formatted):</strong> ${currentDateTime}
                            </div>
                            <div class="mb-3">
                                <strong>Current User's Login:</strong> ${document.getElementById('userLogin').textContent}
                            </div>
                        </div>
                        <pre class="mb-3">${JSON.stringify(response.data, null, 4)}</pre>
                        <div class="alert ${response.data.prediction === 'Approved' ? 'alert-success' : 'alert-danger'} fade show">
                            <i class="fas ${response.data.prediction === 'Approved' ? 'fa-check-circle' : 'fa-times-circle'} me-2"></i>
                            <strong>Prediction:</strong> ${response.data.prediction}
                        </div>
                    `;
        
                    // Update and show result
                    resultContent.innerHTML = displayContent;
                    resultDiv.style.display = 'block';
                    resultDiv.scrollIntoView({ behavior: 'smooth' });
        
                    // Show toast notification
                    toastr[response.data.prediction === 'Approved' ? 'success' : 'warning'](
                        `Loan ${response.data.prediction}`,
                        'Prediction Result'
                    );
                } else {
                    throw new Error('Server returned error status');
                }
        
            } catch (error) {
                // Hide loading modal
                loadingModal.hide();
        
                // Log error details
                console.error('API Error:', error);
        
                // Show detailed error message
                let errorMessage = 'An error occurred while processing your request.';
                if (error.response) {
                    // The request was made and the server responded with a status code
                    // that falls out of the range of 2xx
                    errorMessage = `Server Error: ${error.response.status} - ${error.response.data.message || 'Unknown error'}`;
                } else if (error.request) {
                    // The request was made but no response was received
                    errorMessage = 'Network Error: Could not connect to the server. Please check your internet connection.';
                } else {
                    // Something happened in setting up the request that triggered an Error
                    errorMessage = `Error: ${error.message}`;
                }
        
                // Show error using SweetAlert2
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: errorMessage,
                    footer: 'Please try again or contact support if the problem persists.'
                });
        
                // Update result display with error
                const resultDiv = document.getElementById('resultDisplay');
                const resultContent = document.getElementById('resultContent');
                
                resultContent.innerHTML = `
                    <div class="alert alert-danger">
                        <h5><i class="fas fa-exclamation-triangle me-2"></i>Error</h5>
                        <p class="mb-0">${errorMessage}</p>
                        <small class="text-muted">Time: ${currentDateTime}</small>
                    </div>
                `;
                resultDiv.style.display = 'block';
                
                // Show error toast
                toastr.error(errorMessage, 'Error');
            }
        });
        
        
            // Add input validation styles
            form.querySelectorAll('input, select').forEach(input => {
                input.addEventListener('invalid', (e) => {
                    e.preventDefault();
                    input.classList.add('is-invalid');
                });
        
                input.addEventListener('input', () => {
                    if (input.validity.valid) {
                        input.classList.remove('is-invalid');
                    }
                });
            });
        });
        </script>
</body>
</html>
